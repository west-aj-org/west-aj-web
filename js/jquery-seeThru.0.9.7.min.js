/* jQuery seeThru 0.9.7 - transparent HTML5 video - Copyright (c) 2012 Frederik Ring - for license, docs, et. al. see: see https://github.com/m90/jquery-seeThru */
(function($){function convertAlphaMask(e,c){var b=$("<canvas/>").attr({width:e.width,height:e.height}).get(0).getContext("2d");b.drawImage(c,0,0,e.width,e.height);var f=b.getImageData(0,0,e.width,e.height);for(var d=3,a=f.data.length;d<a;d=d+4){f.data[d-1]=f.data[d-2]=f.data[d-3]=f.data[d];f.data[d]=255}return f}var methods={init:function(a){a||(a={});var b=$.extend({fps:25,start:"autoplay",end:"loop",mask:"",alphaMask:false,width:"",height:"",forceRendering:false},a);return this.each(function(){if($(this).data("seeThru")){$.error("seeThru already initialized on selected element")}var c=false;var e=(b.alphaMask===true);var f=(b.forceRendering===true);var d;if($(b.mask).length){d=$(b.mask)[0];if(d.tagName==="IMG"){$(d).hide();c=true}else{$.error("Mask element must be <img>")}}if(this.tagName==="VIDEO"){$(this).bind("loadedmetadata.seeThru",function(){var s=$(this);var j=this;var m=$(window);var l=c?1:2;var g={width:parseInt(b.width,10),height:parseInt(b.height,10)};if(!g.height||!g.width){if(!s.attr("width")&&!s.attr("height")){g.width=g.width||j.videoWidth;g.height=g.height||j.videoHeight/l}else{if(!s.attr("height")){var r=j.videoWidth/Math.floor(j.videoHeight/l);g.width=g.width||parseInt(s.attr("width"),10);g.height=g.height||parseInt(s.attr("width")/r,10)}else{if(!s.attr("width")){var r=j.videoWidth/Math.floor(j.videoHeight/l);g.width=g.width||parseInt(s.attr("height"),10)*r;g.height=g.height||parseInt(s.attr("height"),10)}else{g.width=g.width||parseInt(s.attr("width"),10);g.height=g.height||parseInt(s.attr("height"),10)/l}}}}var h=$("<canvas/>",{"class":"seeThru-buffer"}).attr({width:g.width,height:g.height*2}).hide();var n=$("<canvas/>",{"class":"seeThru-display"}).attr({width:g.width,height:g.height});var q=n[0].getContext("2d");var o=h[0].getContext("2d");n.bind("mouseenter mouseleave click mousedown mouseup mousemove mouseover hover dblclick contextmenu focus blur",function(u){s.trigger(u)});if(c){d.width=g.width;d.height=g.height;if(e){o.putImageData(convertAlphaMask(g,d),0,g.height)}else{o.drawImage(d,0,g.height,g.width,g.height)}}var k;var p=1/b.fps*1000;s.hide().data("seeThru",{staticMask:c,alphaMask:e,interval:k}).after(h,n);s.bind("play.seeThru",function(){clearInterval(k);k=setInterval(t,p);s.data("seeThru").interval=k}).bind("pause.seeThru",function(){clearInterval(k)});if(b.start==="autoplay"){s.trigger("play.seeThru")}else{if(b.start==="clicktoplay"){j.play();j.pause();t();n.one("click.seeThru",function(){j.play()})}else{if(b.start==="external"){j.play();j.pause();s.bind("timeupdate.seeThru",function(){t()})}else{j.play()}}}if(b.end==="loop"){s.bind("ended.seeThru",function(){j.play()})}else{if(b.end==="rewind"){s.bind("ended.seeThru",function(){j.pause();j.currentTime=0;if(b.start=="clicktoplay"){n.one("click.seeThru",function(){j.play()})}})}else{s.bind("ended.seeThru",function(){j.pause();if(b.start=="clicktoplay"){n.one("click.seeThru",function(){j.play()})}})}}function i(){var u=m.scrollTop();var x=u+m.height();var v=n.offset().top;var w=v+n.height();return(!((v<u&&w<u)||(v>x&&w>x)))}function t(){var y=f?true:i();if(y){o.drawImage(j,0,0,g.width,g.height*l);var x=o.getImageData(0,0,g.width,g.height);var v=o.getImageData(0,g.height,g.width,g.height).data;for(var w=3,u=x.data.length;w<u;w=w+4){x.data[w]=Math.floor((v[w-1]+v[w-2]+v[w-3])/3)}q.putImageData(x,0,0,0,0,g.width,g.height)}}});if(this.videoWidth&&this.videoHeight){$(this).trigger("loadedmetadata.seeThru")}}else{$.error("Selected element must be <video> element")}})},updateMask:function(a){var b=$.extend({mask:"",},a);return this.each(function(){var h=$(this);if($(b.mask).length){var d=h.data("seeThru").staticMask;var f=h.data("seeThru").alphaMask;if(d){if($(b.mask)[0].tagName==="IMG"){var g={width:h.width(),height:h.height()};var e=$(b.mask)[0];e.width=g.width;e.height=g.height;var c=h.nextAll(".seeThru-buffer")[0].getContext("2d");if(f){c.putImageData(convertAlphaMask(g,e),0,g.height)}else{c.drawImage(e,0,g.height,g.width,g.height)}}else{$.error("Passed mask element must be <img>")}}else{$.error("Cannot apply method '.updateMask()' to element with moving alpha")}}else{$.error("Missing parameter 'mask'")}})},revert:function(){return this.each(function(){var a=$(this);if(a.data("seeThru")){clearInterval(a.data("seeThru").interval);a.show().unbind(".seeThru").removeData("seeThru").nextAll(".seeThru-buffer:first,.seeThru-display:first").remove()}})},play:function(){return this.each(function(){if($(this).data("seeThru")){this.play()}})},pause:function(){return this.each(function(){if($(this).data("seeThru")){this.pause()}})},rewind:function(){return this.each(function(){if($(this).data("seeThru")){this.pause();this.currentTime=0}})}};$.fn.seeThru=function(a){if(methods[a]){return methods[a].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof a==="object"||!a){return methods.init.apply(this,arguments)}else{$.error("Method "+a+" does not exist on jQuery.seeThru")}}};})(jQuery);